<!DOCTYPE html>
<html lang="th" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÅ‡∏ö‡∏ö Multiplayer ‡∏™‡∏ô‡∏∏‡∏Å‡πÜ ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå">
    <title>‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç - ‡∏™‡∏ô‡∏∏‡∏Å‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ‡πà ‡∏ó‡∏∏‡∏Å‡πÄ‡∏ß‡∏•‡∏≤</title>
    
    <!-- Google Fonts - Mitr -->
    <link href="https://fonts.googleapis.com/css2?family=Mitr:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Connection Status Indicator -->
    <div id="connection-status" class="hidden">
        <div class="connection-indicator">‚óè</div>
        <span>‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏î‡∏Ç‡∏≤‡∏î</span>
    </div>

    <!-- Screens Container -->
    <div class="screens-container">
        <!-- Splash Screen -->
        <div id="splash-screen" class="game-screen" aria-hidden="true">
            <div class="splash-content">
                <h1 class="splash-title">‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç</h1>
                <div class="instructions">
                    <h2>‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h2>
                    <ol>
                        <li>‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 4 ‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô</li>
                        <li>‡∏ú‡∏•‡∏±‡∏î‡∏Å‡∏±‡∏ô‡∏ó‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô</li>
                        <li>S = ‡∏ñ‡∏π‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á, B = ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏ï‡πà‡∏ú‡∏¥‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</li>
                        <li>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ñ‡∏π‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏≠‡∏î‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞</li>
                    </ol>
                    <p class="start-prompt">‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</p>
                </div>
            </div>
        </div>

        <!-- Lobby Screen -->
        <div id="lobby-screen" class="game-screen" aria-hidden="true">
            <div class="lobby-container">
                <div class="lobby-box">
                    <h1 class="lobby-title">‡πÄ‡∏Å‡∏°‡∏ó‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç</h1>
                    <p class="lobby-description">‡πÄ‡∏ä‡∏¥‡∏ç‡∏ä‡∏ß‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏°‡∏≤‡πÄ‡∏•‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô!</p>
                    
                    <button id="go-to-create-btn" class="lobby-button">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                    <button id="go-to-join-btn" class="lobby-button secondary">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á</button>
                </div>
            </div>
        </div>

        <!-- Create Room Screen -->
        <div id="create-room-screen" class="game-screen" aria-hidden="true">
            <div class="lobby-container">
                <div class="lobby-box">
                    <h1 class="lobby-title">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</h1>
                    
                    <input type="text" id="host-name-input" class="lobby-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" maxlength="20">
                    <input type="text" id="new-room-name-input" class="lobby-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á" maxlength="30">
                    <input type="password" id="new-room-password-input" class="lobby-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (4 ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)" pattern="\d{4}" maxlength="4">
                    
                    <button id="confirm-create-btn" class="lobby-button">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á</button>
                </div>
            </div>
        </div>

        <!-- Room List Screen -->
        <div id="room-list-screen" class="game-screen" aria-hidden="true">
            <div class="lobby-container">
                <div class="lobby-box">
                    <h1 class="lobby-title">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á</h1>
                    <p class="lobby-description">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</p>
                    
                    <div id="room-list-content"></div>
                </div>
            </div>
        </div>

        <!-- Joiner Setup Screen -->
        <div id="joiner-setup-screen" class="game-screen" aria-hidden="true">
            <div class="lobby-container">
                <div class="lobby-box">
                    <h1 class="lobby-title">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á</h1>
                    <p class="lobby-description">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á: <span id="joiner-room-name-display"></span></p>
                    
                    <input type="text" id="joiner-name-input" class="lobby-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì" maxlength="20">
                    
                    <button id="confirm-join-btn" class="lobby-button">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</button>
                </div>
            </div>
        </div>

        <!-- Waiting Room Screen -->
        <div id="waiting-room-screen" class="game-screen" aria-hidden="true">
            <div class="waiting-room-container">
                <h1 class="waiting-room-title">‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h1>
                <div class="room-code-display" id="room-code-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                
                <div class="player-list">
                    <div id="player1-slot" class="player-slot">
                        <div class="player-avatar-initial">?</div>
                        <div class="player-name">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 1</div>
                        <div class="player-status waiting">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠...</div>
                    </div>
                    <div id="player2-slot" class="player-slot">
                        <div class="player-avatar-initial">?</div>
                        <div class="player-name">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 2</div>
                        <div class="player-status waiting">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠...</div>
                    </div>
                    <div id="player3-slot" class="player-slot">
                        <div class="player-avatar-initial">?</div>
                        <div class="player-name">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 3</div>
                        <div class="player-status waiting">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠...</div>
                    </div>
                    <div id="player4-slot" class="player-slot">
                        <div class="player-avatar-initial">?</div>
                        <div class="player-name">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 4</div>
                        <div class="player-status waiting">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠...</div>
                    </div>
                </div>
                
                <p id="waiting-message" class="waiting-message">‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏Ñ‡∏ô...</p>
                <button id="start-game-btn" class="lobby-button" disabled>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
            </div>
        </div>

        <!-- Main Game Screen -->
        <div id="main-game-screen" class="game-screen" aria-hidden="true">
            <div class="main-container">
                <!-- Turn Indicator -->
                <div id="turn-indicator" role="status" aria-live="polite" class="their-turn">
                    <span id="turn-text">‡∏ï‡∏≤‡∏Ç‡∏≠‡∏á ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 2</span>
                    <span id="turn-timer-display">20</span>
                </div>
                
                <!-- Our Number Display -->
                <div class="section">
                    <h2 class="section-title">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
                    <div id="our-number-display" class="input-container">
                        <!-- ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                    </div>
                </div>
                
                <!-- Player Summary Grid -->
                <div class="section">
                    <h2 class="section-title">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h2>
                    <div id="player-summary-grid" role="radiogroup" aria-label="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢"></div>
                </div>
                
                <!-- History Log -->
                <div class="section">
                    <h2 class="section-title">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏¢ <span id="history-target-name">‡πÑ‡∏°‡πà‡∏°‡∏µ</span></h2>
                    <div id="history-log" class="history-log"></div>
                </div>
                
                <!-- Guess Input -->
                <div class="section">
                    <h2 class="section-title">‡∏ó‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</h2>
                    <div id="guess-number-container" class="input-container">
                        <div class="number-input"></div>
                        <div class="number-input"></div>
                        <div class="number-input"></div>
                        <div class="number-input"></div>
                    </div>
                    
                    <!-- Number Pad -->
                    <div id="number-pad-container" class="number-grid"></div>
                    
                    <!-- Final Answer Section -->
                    <div class="final-answer-section">
                        <div class="final-answer-chances">
                            <div class="chance-dot"></div>
                            <div class="chance-dot"></div>
                            <div class="chance-dot"></div>
                        </div>
                        <button id="submit-final-answer-btn" class="final-answer-button">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</button>
                    </div>
                </div>
                
                <!-- Spectator Overlay -->
                <div id="spectator-overlay" class="spectator-overlay">
                    <div class="spectator-message">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏û‡πâ‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏±‡∏ö‡∏ä‡∏°...</div>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="game-over-screen" class="game-screen" aria-hidden="true">
            <div class="game-over-container">
                <h1 id="game-over-title" class="game-over-title">‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡πâ‡∏ß</h1>
                <h2 id="winner-name" class="winner-name">‡∏ú‡∏π‡πâ‡∏ä‡∏ô‡∏∞‡∏Ñ‡∏∑‡∏≠: ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô 1</h2>
                <p id="game-over-message" class="game-over-message">‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏≠‡∏î‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏Ñ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢!</p>
                
                <div id="game-over-numbers-container" class="game-over-numbers"></div>
                
                <div class="game-over-buttons">
                    <button id="rematch-btn" class="lobby-button">‡πÄ‡∏•‡πà‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                    <button id="back-to-lobby-btn" class="lobby-button secondary">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="password-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="password-modal-room-name" class="modal-title">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h2>
            <input type="password" id="password-modal-input" class="lobby-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô 4 ‡∏ï‡∏±‡∏ß" maxlength="4">
            <button id="password-modal-submit-btn" class="lobby-button">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" role="alert" aria-live="polite" class="toast-notification"></div>
    <div id="action-toast" role="status" aria-live="polite" class="action-toast">
        <span id="action-toast-text"></span>
    </div>

    <!-- Sound Control -->
    <button id="sound-control" aria-label="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡πÄ‡∏™‡∏µ‡∏¢‡∏á">
        <span id="sound-icon">üîä</span>
    </button>

    <!-- Scripts -->
    <script type="module">
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô WebP
        const checkWebP = new Promise((resolve) => {
            const webP = new Image();
            webP.onload = webP.onerror = () => resolve(webP.height === 2);
            webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IIcAAACyAgCdASoCAAEALmk0mk0iIiIiIgBoSygABc6hWWSAAAA=';
        });
        
        // ‡πÇ‡∏´‡∏•‡∏î Firebase SDK ‡∏Å‡πà‡∏≠‡∏ô
        (async function() {
            const supportsWebP = await checkWebP;
            
            // ‡πÇ‡∏´‡∏•‡∏î Firebase SDK
            const firebaseScript = document.createElement('script');
            firebaseScript.src = "https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js";
            document.head.appendChild(firebaseScript);
            
            const firebaseDBScript = document.createElement('script');
            firebaseDBScript.src = "https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js";
            document.head.appendChild(firebaseDBScript);
            
            const firebaseAuthScript = document.createElement('script');
            firebaseAuthScript.src = "https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js";
            document.head.appendChild(firebaseAuthScript);
            
            // ‡∏£‡∏≠‡πÉ‡∏´‡πâ Firebase ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à
            await new Promise((resolve) => {
                firebaseScript.onload = resolve;
            });
            
            // ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å
            const mainScript = document.createElement('script');
            mainScript.type = "modu